# 0) detect-secrets: scan only staged files (A,C,M,R)
git diff --cached --name-only -z --diff-filter=ACMR | \
  xargs -0 -n 100 detect-secrets-hook --baseline .secrets.baseline
if [ $? -ne 0 ]; then
  echo "❌ Secret detected by detect-secrets. Commit aborted."
  echo "   -> If REAL: remove from code, rotate the key, and move to GitHub Actions Secrets/.env."
  echo "   -> If FALSE POSITIVE: add '// pragma: allowlist secret' and update baseline."
  exit 1
fi

# 1) ESLint (fail on warnings too)
npm run lint --max-warnings=0 || { echo "❌ Lint failed. Commit aborted."; exit 1; }

# 2) (Optional) Tests
# npm run test || { echo "❌ Tests failed. Commit aborted."; exit 1; }

# 3) lint-staged
npx lint-staged || { echo "❌ lint-staged failed. Commit aborted."; exit 1; }
